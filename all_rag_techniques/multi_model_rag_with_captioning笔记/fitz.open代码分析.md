è¿™æ®µ Python ä»£ç çš„ä½œç”¨æ˜¯ï¼š

---

## âœ… ç”¨é€šä¿—äººè¯è§£é‡Š

> å®ƒä¼š**éå†ä¸€ä¸ª PDF æ–‡ä»¶çš„æ¯ä¸€é¡µ**ï¼Œç„¶åï¼š

1. **æå–è¯¥é¡µçš„æ–‡å­—å†…å®¹**ï¼Œä¿å­˜åœ¨ä¸€ä¸ª `text_data` åˆ—è¡¨ä¸­ï¼›
2. **æå–è¯¥é¡µä¸Šçš„æ‰€æœ‰å›¾ç‰‡**ï¼ŒæŠŠå®ƒä»¬**ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶å¤¹ `extracted_images/`** ä¸­ï¼›
3. å›¾ç‰‡ä¼šä»¥å‘½åè§„åˆ™ï¼š`image_é¡µç _ç¼–å·.æ ¼å¼` ä¿å­˜ï¼Œæ¯”å¦‚ï¼š`image_2_1.png` è¡¨ç¤ºç¬¬ 2 é¡µç¬¬ 1 å¼ å›¾ã€‚

ä½ å¯ä»¥ç”¨å®ƒæ¥**æ‰¹é‡æŠ½å–ä¸€ç¯‡ PDF è®ºæ–‡æˆ–æ–‡æ¡£çš„æ‰€æœ‰æ–‡æœ¬å’Œæ’å›¾**ï¼Œæ–¹ä¾¿åç»­åš NLP åˆ†æã€OCRã€å›¾æ–‡åˆ†ç¦»ã€æ•°æ®åº“å­˜å‚¨ç­‰ã€‚

---

## ğŸ“¦ æ¯æ®µä»£ç è¯¦ç»†æ‹†è§£ + ä¸¾ä¾‹

```python
text_data = []
img_data = []
```

* `text_data`: ç”¨æ¥ä¿å­˜æ¯ä¸€é¡µçš„æ–‡æœ¬å†…å®¹ï¼ˆæ¯”å¦‚æ­£æ–‡ã€æ ‡é¢˜ã€æ®µè½ï¼‰ã€‚
* `img_data`: è™½ç„¶è¿™é‡Œæ²¡ç”¨åˆ°ï¼Œä½†å¯ä»¥ç”¨æ¥ä¿å­˜æå–çš„å›¾åƒå…ƒæ•°æ®æˆ–å¼•ç”¨ã€‚

---

```python
with fitz.open('attention_is_all_you_need.pdf') as pdf_file:
```

* `fitz` æ˜¯ `PyMuPDF` çš„åˆ«åï¼Œè¿™æ˜¯ä¸€ä¸ªå¤„ç† PDF æ–‡æ¡£çš„åº“ã€‚
* è¿™è¡Œä»£ç æ‰“å¼€ PDF æ–‡ä»¶ã€ŠAttention Is All You Needã€‹ï¼ˆTransformer è®ºæ–‡ï¼‰ã€‚

---

```python
if not os.path.exists("extracted_images"):
    os.makedirs("extracted_images")
```

* å¦‚æœè¿˜æ²¡åˆ›å»ºç›®å½• `extracted_images/`ï¼Œå°±æ–°å»ºä¸€ä¸ªï¼›
* æ‰€æœ‰æå–çš„å›¾ç‰‡éƒ½ä¼šä¿å­˜åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚

---

```python
for page_number in range(len(pdf_file)):
    page = pdf_file[page_number]
```

* éå† PDF çš„æ¯ä¸€é¡µï¼ˆ0 å¼€å§‹ç¼–å·ï¼‰ï¼›
* `page` æ˜¯å½“å‰é¡µçš„å†…å®¹ã€‚

---

```python
text = page.get_text().strip()
text_data.append({"response": text, "name": page_number+1})
```

* ä»è¿™ä¸€é¡µä¸­æå–å‡º **çº¯æ–‡æœ¬å†…å®¹**ï¼Œå»æ‰å‰åç©ºæ ¼ï¼›
* ä¿å­˜åˆ° `text_data` ä¸­ï¼Œç»“æ„å¦‚ä¸‹ï¼š

  ```python
  {"response": "è¿™é¡µçš„æ–‡å­—", "name": 1}
  ```

---

```python
images = page.get_images(full=True)
```

* å¾—åˆ°å½“å‰é¡µä¸­æ‰€æœ‰çš„å›¾ç‰‡åˆ—è¡¨ï¼›
* æ¯å¼ å›¾ç‰‡æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«å®ƒåœ¨ PDF ä¸­çš„èµ„æºç¼–å·ã€å°ºå¯¸ç­‰ä¿¡æ¯ã€‚

---

```python
for image_index, img in enumerate(images, start=0):
    xref = img[0]
```

* éå†å½“å‰é¡µçš„æ‰€æœ‰å›¾ç‰‡ï¼›
* `xref` æ˜¯è¿™å¼ å›¾ç‰‡åœ¨ PDF ä¸­çš„å”¯ä¸€ IDï¼ˆèµ„æºç¼–å·ï¼‰ï¼Œåç»­å¯ä»¥ç”¨å®ƒæå–å›¾åƒã€‚

---

```python
base_image = pdf_file.extract_image(xref)
image_bytes = base_image["image"]
image_ext = base_image["ext"]
```

* ç”¨ `xref` æŠŠå›¾ç‰‡ä» PDF ä¸­æå–å‡ºæ¥ï¼›
* `image_bytes` æ˜¯å›¾åƒçš„äºŒè¿›åˆ¶æ•°æ®ï¼›
* `image_ext` æ˜¯å›¾ç‰‡çš„æ ¼å¼ï¼Œæ¯”å¦‚ `'png'`ã€`'jpeg'`ã€‚

---

```python
image = Image.open(io.BytesIO(image_bytes))
image.save(f"extracted_images/image_{page_number+1}_{image_index+1}.{image_ext}")
```

* ç”¨ PIL æŠŠäºŒè¿›åˆ¶å›¾åƒè½¬æˆå›¾ç‰‡å¯¹è±¡ï¼›
* ç„¶åä¿å­˜åˆ° `extracted_images` ç›®å½•ä¸‹ï¼›
* æ–‡ä»¶åè§„åˆ™ï¼šç¬¬å‡ é¡µç¬¬å‡ å¼ å›¾ï¼Œä¾‹å¦‚ï¼š

  * ç¬¬ 1 é¡µç¬¬ 1 å¼ å›¾ï¼š`image_1_1.png`
  * ç¬¬ 3 é¡µç¬¬ 2 å¼ å›¾ï¼š`image_3_2.jpeg`

---

## ğŸ§ª ä¸¾ä¸ªçœŸå®ä¾‹å­

å‡è®¾ä½ çš„ PDF æ˜¯ç»å…¸ Transformer è®ºæ–‡ `attention_is_all_you_need.pdf`ï¼Œå®ƒæ€»å…±æœ‰ 12 é¡µï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

* ç¬¬ 1 é¡µæ˜¯æ‘˜è¦ + ä½œè€…ï¼›
* ç¬¬ 2 é¡µæœ‰æ¨¡å‹å›¾ï¼ˆä¼šè¢«æå–ä¸º `image_2_1.png`ï¼‰ï¼›
* ç¬¬ 4 é¡µæœ‰æ³¨æ„åŠ›æƒé‡çš„å¯è§†åŒ–å›¾ï¼ˆæå–ä¸º `image_4_1.jpeg`ï¼‰ï¼›

è¿è¡Œåæ•ˆæœå¦‚ä¸‹ï¼š

âœ… `text_data` å†…å®¹ç¤ºä¾‹ï¼ˆç¬¬1é¡µï¼‰ï¼š

```python
[{"response": "Attention Is All You Need\nAshish Vaswani, ...", "name": 1}, ...]
```

âœ… æœ¬åœ°ç”Ÿæˆå›¾ç‰‡æ–‡ä»¶ï¼š

```
extracted_images/
â”œâ”€â”€ image_2_1.png
â”œâ”€â”€ image_4_1.jpeg
...
```

---

## ğŸ“Œ æ€»ç»“è¡¨æ ¼

| åŠŸèƒ½        | è¯´æ˜                       |
| --------- | ------------------------ |
| æå– PDF æ–‡æœ¬ | æ¯é¡µå†…å®¹å­˜å…¥ `text_data`       |
| æå– PDF å›¾åƒ | æ¯é¡µå›¾ç‰‡æå–å¹¶ä¿å­˜ä¸ºæ–‡ä»¶             |
| è‡ªåŠ¨å‘½åå›¾ç‰‡æ–‡ä»¶  | `image_é¡µç _ç¼–å·.æ‰©å±•å`        |
| åˆ›å»ºä¿å­˜ç›®å½•    | è‡ªåŠ¨åˆ›å»º `extracted_images/` |
| é€‚ç”¨åœºæ™¯      | æ‰¹é‡æå–è®ºæ–‡å›¾æ–‡ã€æ–‡æ¡£åˆ†ç¦»ã€å›¾æ–‡åˆ†æ       |

---

å¦‚æœä½ éœ€è¦ï¼š

* æå–ç‰¹å®šé¡µèŒƒå›´ï¼ˆæ¯”å¦‚ç¬¬3åˆ°7é¡µï¼‰
* åªæå›¾ç‰‡ä¸ææ–‡å­—
* å›¾ç‰‡æå–åè½¬ä¸º base64ã€æ•°æ®åº“å­˜å‚¨
  æˆ‘å¯ä»¥ç»§ç»­å¸®ä½ æ”¹è¿›è¿™æ®µä»£ç ã€‚æ˜¯å¦è¦æˆ‘å¸®ä½ åŠ ä¸Šï¼Ÿ
